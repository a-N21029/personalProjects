CREATE TABLE User (
SIN INT(9) not null,
firstName VARCHAR(25) not null,
lastName VARCHAR(25) not null,
Username VARCHAR(25) not null UNIQUE,
Dob DATE not null,
Address VARCHAR(50) not null,
Occupation VARCHAR(25) not null,
password VARCHAR(20) not null,
PRIMARY KEY(SIN)
);

CREATE TABLE Renter (
SIN INT(9) not null,
PRIMARY KEY(SIN),
FOREIGN KEY(SIN) REFERENCES User(SIN)
ON DELETE CASCADE
ON UPDATE CASCADE
);

CREATE TABLE Host (
SIN INT(9) not null,
PRIMARY KEY(SIN),
FOREIGN KEY(SIN) REFERENCES User(SIN)
ON DELETE CASCADE
ON UPDATE CASCADE
);

CREATE TABLE Listing(
Address CHAR(30) not null,
postalCode CHAR(12) not null,
City CHAR(20),
Country CHAR(20),
Type CHAR(15) not null,
Latitude DECIMAL(7, 5),
Longitude DECIMAL(8,5), 
pricePerNight INT(5),
Host INT(9) not null,
PRIMARY KEY(address, postalCode),
FOREIGN KEY(host) REFERENCES Host(SIN) ON DELETE CASCADE
);

CREATE TABLE Amenity (
Name CHAR(20) not null,
PRIMARY KEY(name)
);

CREATE TABLE DateRange (
startDate DATE,
endDate DATE,
PRIMARY KEY(startDate, endDate)
);

CREATE TABLE RenterReview(
hostSIN INT(9) not null,
renterSIN INT(9) not null,
Comment TINYTEXT not null,
Rating FLOAT not null,
PRIMARY KEY(hostSIN, renterSIN),
FOREIGN KEY(hostSIN) REFERENCES Host(SIN),
FOREIGN KEY(renterSIN) REFERENCES Renter(SIN) ON DELETE CASCADE
);

CREATE TABLE ListingReview(
renterSIN INT(9) not null,
listingAddress CHAR(30),
listingPostalCode CHAR(12),
Comment TINYTEXT not null,
Rating FLOAT not null,
PRIMARY KEY(renterSIN, listingAddress, listingPostalCode),
FOREIGN KEY(renterSIN) REFERENCES Renter(SIN) ,
FOREIGN KEY(listingAddress, listingPostalCode) REFERENCES Listing(address, postalCode) ON DELETE CASCADE
);

CREATE TABLE Reservation (
renterSIN INT(9) not null,
listingAddress CHAR(50) not null,
listingPostalCode CHAR(12) not null,
Payment VARCHAR(30) not null,
checkIn DATE not null,
CheckOut DATE not null,
isCancelled TINYINT(1) not null DEFAULT 0,
totalPrice INT(10) not null,
PRIMARY KEY(listingAddress, listingPostalCode, checkIn, checkOut),
FOREIGN KEY(renterSIN) REFERENCES Renter(SIN) ON DELETE CASCADE,
FOREIGN KEY(listingAddress, listingPostalCode) REFERENCES Listing(address, postalCode) ON DELETE CASCADE,
FOREIGN KEY(checkIn, checkOut) REFERENCES DateRange(startDate, endDate)
);

CREATE TABLE Offers (
listingAddress CHAR(50) not null,
listingPostalCode CHAR(12) not null,
Amenity CHAR(20) not null,
PRIMARY KEY(listingAddress, amenity),
FOREIGN KEY(listingAddress, listingPostalCode) REFERENCES Listing(address, postalCode) ON DELETE CASCADE,
FOREIGN KEY (amenity) REFERENCES Amenity(name) ON DELETE CASCADE
);

CREATE TABLE Unavailability (
listingAddress CHAR(50) not null,
listingPostalCode CHAR(12) not null,
startDate DATE not null,
endDate DATE not null,
PRIMARY KEY(listingAddress, listingPostalCode, startDate, endDate),
FOREIGN KEY(listingAddress, listingPostalCode) REFERENCES Listing(address, postalCode) ON DELETE CASCADE,
FOREIGN KEY (startDate, endDate) REFERENCES DateRange(startDate, endDate)
);
